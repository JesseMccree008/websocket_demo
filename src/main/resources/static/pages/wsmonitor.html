<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8"/>
    <title>websocket监控</title>
    <script src="/js/jquery.min.js"></script>
    <style>
        .sendall{color: red;}
    </style>
</head>
<body>
<h1>websocket监控</h1>
<div id="count"></div>
<div id="onlinedetails"></div>
<div class="sendall">群发消息：<input id="sendAllMsg" value=""><input type="button" value="推送" onclick="sendAll()"></div>
</body>
<script>
    $(function () {
        var html="";
        var html1="";
        $.ajax({
            type: "get",
            url: "/getOnlineDetails",
            data: {},
            dataType: "json",
            success: function (data) {
                if (data){
                    html="<label>链接数："+data.count+"</label>"
                    $("#count").html(html);
                    $.each(data.addrs,function (i,o) {
                        html1 += "<label>客户ip："+o.addr+"</label>-----<label>客户id："+o.userid+"</label><br>"
                    })
                    $("#onlinedetails").html(html1);
                }
            },
            error: function () {
                alert("信息查询失败")
            }
        });
    });

    function sendAll() {
        $.ajax({
            type: "POST",
            url: "/senAllMsg",
            data: {"msg":$("#sendAllMsg").val()},
            dataType: "json",
            success: function (data) {
                if (data){
                    alert("群发成功！")
                } else{
                    alert("群发失败！")
                }
            },
            error: function () {
                alert("接口异常！")
            }
        });

    }

</script>
</html>